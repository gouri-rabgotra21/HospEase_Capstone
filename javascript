const content = {
    en: {
        hospitalName: "Vardhman Mahaveer Health Care",
        navHome: "Home",
        nav3D: "3D View",
        navChatbot: "Chatbot",
        navContact: "Contact Us",
        heroTitle: "Your Health, Our Priority",
        heroSubtitle: "Providing Comprehensive & Compassionate Care in Patiala.",
        heroCta: "Book an Appointment",
        aboutTitle: "About Us",
        aboutText: "Vardhman Mahaveer Health Care is a premier multi-specialty hospital located in the heart of Patiala. With a patient-centric approach and a team of highly skilled medical professionals, we are committed to providing comprehensive, personalized, and compassionate care to our community. Our state-of-the-art facilities and a wide range of specialized services ensure that we meet the diverse healthcare needs of our patients with the utmost dedication and excellence.",
        servicesTitle: "Our Services",
        serviceCardioTitle: "Cardiology",
        serviceCardioText: "Comprehensive care for heart and vascular health, including diagnostic and interventional procedures.",
        serviceOrthoTitle: "Orthopedics",
        serviceOrthoText: "Expert treatment for bone, joint, and muscle conditions, from sports injuries to joint replacement surgery.",
        serviceObgynTitle: "Obstetrics & Gynaecology",
        serviceObgynText: "Providing comprehensive care for women's health, including maternity and reproductive services.",
        serviceDentalTitle: "Dentistry",
        serviceDentalText: "Advanced dental care, from general dentistry to oral and maxillofacial surgery.",
        serviceSurgeryTitle: "General Surgery",
        serviceSurgeryText: "Skilled surgical team for a wide range of procedures, ensuring patient safety and effective outcomes.",
        serviceNeuroTitle: "Neurology",
        serviceNeuroText: "Diagnosis and treatment of disorders affecting the nervous system, including the brain and spine.",
        locationTitle: "Find Us",
        locationCardTitle: "Our Location",
        locationText1: "Vardhman Mahaveer Health Care is conveniently located on Rajpura Road in Urban Estate, Patiala. Our easily accessible location ensures a smooth commute for all our patients and visitors.",
        locationAddress: "Address: S.C.O-34, Urban Estate, Phase-2, Rajpura Road, Patiala, Punjab, 147002",
        locationPhone: "Phone: 0175-5051234",
        threeDTitle: "3D View of a Hospital",
        threeDNote: "*This is a symbolic 3D representation and not an exact replica of the hospital building. You can click and drag to rotate the model and right-click to pan.",
        chatbotTitle: "Hospital Chatbot",
        chatbotIntroMessage: "Hello! How can I help you today? You can ask me about our services, timings, or location.",
        chatInputPlaceholder: "Type your message...",
        chatSendBtn: "Send",
        contactTitle: "Contact & Appointments",
        contactCardTitle: "Contact & Appointments",
        contactText1: "For appointments or inquiries, please contact us at:",
        contactPhone: "0175-5051234",
        contactEmail: "info@vardhmanhealthcare.com",
        footerText: "&copy; 2025 Vardhman Mahaveer Health Care. All rights reserved.",
        greetings: "Hello there! How can I help you today?",
        insurance: "We accept all major insurance providers. Please contact our billing department for more details.",
    },
    hi: {
        hospitalName: "वर्धमान महावीर हेल्थ केयर",
        navHome: "होम",
        nav3D: "3डी व्यू",
        navChatbot: "चैटबॉट",
        navContact: "संपर्क करें",
        heroTitle: "आपकी सेहत, हमारी प्राथमिकता",
        heroSubtitle: "पटियाला में व्यापक और दयालु देखभाल प्रदान करना।",
        heroCta: "अपॉइंटमेंट बुक करें",
        aboutTitle: "हमारे बारे में",
        aboutText: "वर्धमान महावीर हेल्थ केयर पटियाला के दिल में स्थित एक प्रमुख मल्टी-स्पेशियलिटी अस्पताल है। एक मरीज-केंद्रित दृष्टिकोण और अत्यधिक कुशल चिकित्सा पेशेवरों की एक टीम के साथ, हम अपने समुदाय को व्यापक, व्यक्तिगत और दयालु देखभाल प्रदान करने के लिए प्रतिबद्ध हैं। हमारी अत्याधुनिक सुविधाएं और विशेष सेवाओं की एक विस्तृत श्रृंखला यह सुनिश्चित करती है कि हम अपने मरीजों की विविध स्वास्थ्य देखभाल आवश्यकताओं को अत्यंत समर्पण और उत्कृष्टता के साथ पूरा करें।",
        servicesTitle: "हमारी सेवाएँ",
        serviceCardioTitle: "कार्डियोलॉजी",
        serviceCardioText: "हृदय और रक्त वाहिकाओं के स्वास्थ्य के लिए व्यापक देखभाल, जिसमें नैदानिक और इंटरवेंशनल प्रक्रियाएं शामिल हैं।",
        serviceOrthoTitle: "आर्थोपेडिक्स",
        serviceOrthoText: "हड्डी, जोड़ों और मांसपेशियों की स्थितियों के लिए विशेषज्ञ उपचार, खेल की चोटों से लेकर जोड़ों के प्रतिस्थापन सर्जरी तक।",
        serviceObgynTitle: "प्रसूति एवं स्त्री रोग",
        serviceObgynText: "मातृत्व और प्रजनन सेवाओं सहित महिलाओं के स्वास्थ्य के लिए व्यापक देखभाल प्रदान करना।",
        serviceDentalTitle: "दंत चिकित्सा",
        serviceDentalText: "सामान्य दंत चिकित्सा से लेकर मौखिक और मैक्सिलोफेशियल सर्जरी तक, उन्नत दंत चिकित्सा देखभाल।",
        serviceSurgeryTitle: "जनरल सर्जरी",
        serviceSurgeryText: "मरीज की सुरक्षा और प्रभावी परिणामों को सुनिश्चित करने के लिए, विभिन्न प्रकार की प्रक्रियाओं के लिए कुशल सर्जिकल टीम।",
        serviceNeuroTitle: "न्यूरोलॉजी",
        serviceNeuroText: "तंत्रिका तंत्र, जिसमें मस्तिष्क और रीढ़ की हड्डी शामिल है, को प्रभावित करने वाले विकारों का निदान और उपचार।",
        locationTitle: "हमें खोजें",
        locationCardTitle: "हमारा स्थान",
        locationText1: "वर्धमान महावीर हेल्थ केयर पटियाला के अर्बन एस्टेट में राजपुरा रोड पर सुविधाजनक रूप से स्थित है। हमारा आसानी से सुलभ स्थान हमारे सभी मरीजों और आगंतुकों के लिए एक सहज आवागमन सुनिश्चित करता है।",
        locationAddress: "पता: एस.सी.ओ-34, अर्बन एस्टेट, चरण-2, राजपुरा रोड, पटियाला, पंजाब, 147002",
        locationPhone: "फ़ोन: 0175-5051234",
        threeDTitle: "एक अस्पताल का 3डी दृश्य",
        threeDNote: "*यह एक प्रतीकात्मक 3डी प्रतिनिधित्व है और अस्पताल के भवन की सटीक प्रतिकृति नहीं है। आप मॉडल को घुमाने के लिए क्लिक और खींच सकते हैं।",
        chatbotTitle: "अस्पताल चैटबॉट",
        chatbotIntroMessage: "नमस्ते! मैं आज आपकी कैसे मदद कर सकता हूँ? आप मुझसे हमारी सेवाओं, समय या स्थान के बारे में पूछ सकते हैं।",
        chatInputPlaceholder: "अपना संदेश लिखें...",
        chatSendBtn: "भेजें",
        contactTitle: "संपर्क और अपॉइंटमेंट",
        contactCardTitle: "संपर्क और अपॉइंटमेंट",
        contactText1: "अपॉइंटमेंट या पूछताछ के लिए, कृपया हमसे संपर्क करें:",
        contactPhone: "0175-5051234",
        contactEmail: "info@vardhmanhealthcare.com",
        footerText: "&copy; 2025 वर्धमान महावीर हेल्थ केयर। सर्वाधिकार सुरक्षित।",
        greetings: "नमस्ते! मैं आज आपकी कैसे मदद कर सकता हूँ?",
        insurance: "हम सभी प्रमुख बीमा प्रदाताओं को स्वीकार करते हैं। अधिक जानकारी के लिए कृपया हमारे बिलिंग विभाग से संपर्क करें।",
    },
    pa: {
        hospitalName: "ਵਰਧਮਾਨ ਮਹਾਵੀਰ ਹੈਲਥ ਕੇਅਰ",
        navHome: "ਹੋਮ",
        nav3D: "3D ਵਿਊ",
        navChatbot: "ਚੈਟਬੋਟ",
        navContact: "ਸੰਪਰਕ ਕਰੋ",
        heroTitle: "ਤੁਹਾਡੀ ਸਿਹਤ, ਸਾਡੀ ਪਹਿਲ",
        heroSubtitle: "ਪਟਿਆਲਾ ਵਿੱਚ ਵਿਆਪਕ ਅਤੇ ਹਮਦਰਦ ਦੇਖਭਾਲ ਪ੍ਰਦਾਨ ਕਰਨਾ।",
        heroCta: "ਅਪੁਆਇੰਟਮੈਂਟ ਬੁੱਕ ਕਰੋ",
        aboutTitle: "ਸਾਡੇ ਬਾਰੇ",
        aboutText: "ਵਰਧਮਾਨ ਮਹਾਵੀਰ ਹੈਲਥ ਕੇਅਰ ਪਟਿਆਲਾ ਦੇ ਅਰਬਨ ਅਸਟੇਟ ਵਿੱਚ ਰਾਜਪੁਰਾ ਰੋਡ 'ਤੇ ਸੁਵਿਧਾਜਨਕ ਤੌਰ 'ਤੇ ਸਥਿਤ ਹੈ। ਸਾਡਾ ਆਸਾਨੀ ਨਾਲ ਪਹੁੰਚਯੋਗ ਟਿਕਾਣਾ ਸਾਡੇ ਸਾਰੇ ਮਰੀਜ਼ਾਂ ਅਤੇ ਸੈਲਾਨੀਆਂ ਲਈ ਇੱਕ ਸੁਚਾਰੂ ਆਵਾਜਾਈ ਨੂੰ ਯਕੀਨੀ ਬਣਾਉਂਦਾ ਹੈ।",
        servicesTitle: "ਸਾਡੀਆਂ ਸੇਵਾਵਾਂ",
        serviceCardioTitle: "ਕਾਰਡੀਓਲੋਜੀ",
        serviceCardioText: "ਦਿਲ ਅਤੇ ਨਾੜੀ ਸਿਹਤ ਲਈ ਵਿਆਪਕ ਦੇਖਭਾਲ, ਜਿਸ ਵਿੱਚ ਨਿਦਾਨ ਅਤੇ ਇੰਟਰਵੈਂਸ਼ਨਲ ਪ੍ਰਕਿਰਿਆਵਾਂ ਸ਼ਾਮਲ ਹਨ।",
        serviceOrthoTitle: "ਆਰਥੋਪੈਡਿਕਸ",
        serviceOrthoText: "ਹੱਡੀਆਂ, ਜੋੜਾਂ ਅਤੇ ਮਾਸਪੇਸ਼ੀਆਂ ਦੀਆਂ ਸਥਿਤੀਆਂ ਲਈ ਮਾਹਰ ਇਲਾਜ, ਖੇਡਾਂ ਦੀਆਂ ਸੱਟਾਂ ਤੋਂ ਲੈ ਕੇ ਜੋੜਾਂ ਦੀ ਬਦਲੀ ਦੀ ਸਰਜਰੀ ਤੱਕ।",
        serviceObgynTitle: "ਪ੍ਰਸੂਤੀ ਅਤੇ ਇਸਤਰੀ ਰੋਗ",
        serviceObgynText: "ਮਾਂ ਅਤੇ ਪ੍ਰਜਨਨ ਸੇਵਾਵਾਂ ਸਮੇਤ, ਔਰਤਾਂ ਦੀ ਸਿਹਤ ਲਈ ਵਿਆਪਕ ਦੇਖਭਾਲ ਪ੍ਰਦਾਨ ਕਰਨਾ।",
        serviceDentalTitle: "ਦੰਦਾਂ ਦੀ ਦੇਖਭਾਲ",
        serviceDentalText: "ਸਧਾਰਨ ਦੰਦਾਂ ਦੀ ਦੇਖਭਾਲ ਤੋਂ ਲੈ ਕੇ ਮੌਖਿਕ ਅਤੇ ਮੈਕਸਿਲੋਫੇਸ਼ੀਅਲ ਸਰਜਰੀ ਤੱਕ, ਉੱਨਤ ਦੰਦਾਂ ਦੀ ਦੇਖਭਾਲ।",
        serviceSurgeryTitle: "ਜਨਰਲ ਸਰਜਰੀ",
        serviceSurgeryText: "ਮਰੀਜ਼ ਦੀ ਸੁਰੱਖਿਆ ਅਤੇ ਪ੍ਰਭਾਵਸ਼ਾਲੀ ਨਤੀਜਿਆਂ ਨੂੰ ਯਕੀਨੀ ਬਣਾਉਣ ਲਈ, ਕਈ ਤਰ੍ਹਾਂ ਦੀਆਂ ਪ੍ਰਕਿਰਿਆਵਾਂ ਲਈ ਹੁਨਰਮੰਦ ਸਰਜੀਕਲ ਟੀਮ।",
        serviceNeuroTitle: "ਨਿਊਰੋਲੋਜੀ",
        serviceNeuroText: "ਤੰਤੂ ਪ੍ਰਣਾਲੀ, ਜਿਸ ਵਿੱਚ ਦਿਮਾਗ ਅਤੇ ਰੀੜ੍ਹ ਦੀ ਹੱਡੀ ਸ਼ਾਮਲ ਹੈ, ਨੂੰ ਪ੍ਰਭਾਵਿਤ ਕਰਨ ਵਾਲੇ ਰੋਗਾਂ ਦਾ ਨਿਦਾਨ ਅਤੇ ਇਲਾਜ।",
        locationTitle: "ਸਾਨੂੰ ਲੱਭੋ",
        locationCardTitle: "ਸਾਡਾ ਟਿਕਾਣਾ",
        locationText1: "ਵਰਧਮਾਨ ਮਹਾਵੀਰ ਹੈਲਥ ਕੇਅਰ ਪਟਿਆਲਾ ਦੇ ਅਰਬਨ ਅਸਟੇਟ ਵਿੱਚ ਰਾਜਪੁਰਾ ਰੋਡ 'ਤੇ ਸੁਵਿਧਾਜਨਕ ਤੌਰ 'ਤੇ ਸਥਿਤ ਹੈ। ਸਾਡਾ ਆਸਾਨੀ ਨਾਲ ਪਹੁੰਚਯੋਗ ਟਿਕਾਣਾ ਸਾਡੇ ਸਾਰੇ ਮਰੀਜ਼ਾਂ ਅਤੇ ਸੈਲਾਨੀਆਂ ਲਈ ਇੱਕ ਸੁਚਾਰੂ ਆਵਾਜਾਈ ਨੂੰ ਯਕੀਨੀ ਬਣਾਉਂਦਾ ਹੈ।",
        locationAddress: "ਪਤਾ: ਐਸ.ਸੀ.ਓ-34, ਅਰਬਨ ਅਸਟੇਟ, ਫੇਜ਼-2, ਰਾਜਪੁਰਾ ਰੋਡ, ਪਟਿਆਲਾ, ਪੰਜਾਬ, 147002",
        locationPhone: "ਫ਼ੋਨ: 0175-5051234",
        threeDTitle: "ਇੱਕ ਹਸਪਤਾਲ ਦਾ 3ਡੀ ਵਿਊ",
        threeDNote: "*ਇਹ ਇੱਕ ਪ੍ਰਤੀਕਾਤਮਕ 3D ਪ੍ਰਤੀਨਿਧਤਾ ਹੈ ਅਤੇ ਹਸਪਤਾਲ ਦੀ ਇਮਾਰਤ ਦੀ ਸਹੀ ਪ੍ਰਤੀਕ੍ਰਿਤੀ ਨਹੀਂ ਹੈ। ਤੁਸੀਂ ਮਾਡਲ ਨੂੰ ਘੁਮਾਉਣ ਲਈ ਕਲਿੱਕ ਅਤੇ ਡਰੈਗ ਕਰ ਸਕਦੇ ਹੋ।",
        chatbotTitle: "ਹਸਪਤਾਲ ਚੈਟਬੋਟ",
        chatbotIntroMessage: "ਨਮਸਤੇ! ਮੈਂ ਅੱਜ ਤੁਹਾਡੀ ਕਿਵੇਂ ਮਦਦ ਕਰ ਸਕਦਾ ਹਾਂ? ਤੁਸੀਂ ਮੈਨੂੰ ਸਾਡੀਆਂ ਸੇਵਾਵਾਂ, ਸਮੇਂ ਜਾਂ ਸਥਾਨ ਬਾਰੇ ਪੁੱਛ ਸਕਦੇ ਹੋ।",
        chatInputPlaceholder: "ਆਪਣਾ ਸੁਨੇਹਾ ਟਾਈਪ ਕਰੋ...",
        chatSendBtn: "ਭੇਜੋ",
        contactTitle: "ਸੰਪਰਕ ਅਤੇ ਅਪੁਆਇੰਟਮੈਂਟ",
        contactCardTitle: "ਸੰਪਰਕ ਅਤੇ ਅਪੁਆਇੰਟਮੈਂਟ",
        contactText1: "ਅਪੁਆਇੰਟਮੈਂਟ ਜਾਂ ਪੁੱਛਗਿੱਛ ਲਈ, ਕਿਰਪਾ ਕਰਕੇ ਸਾਡੇ ਨਾਲ ਸੰਪਰਕ ਕਰੋ:",
        contactPhone: "0175-5051234",
        contactEmail: "info@vardhmanhealthcare.com",
        footerText: "&copy; 2025 ਵਰਧਮਾਨ ਮਹਾਵੀਰ ਹੈਲਥ ਕੇਅਰ। ਸਾਰੇ ਹੱਕ ਰਾਖਵੇਂ ਹਨ।",
        greetings: "ਸਤਿ ਸ੍ਰੀ ਅਕਾਲ! ਮੈਂ ਅੱਜ ਤੁਹਾਡੀ ਕਿਵੇਂ ਮਦਦ ਕਰ ਸਕਦਾ ਹਾਂ?",
        insurance: "ਅਸੀਂ ਸਾਰੇ ਪ੍ਰਮੁੱਖ ਬੀਮਾ ਪ੍ਰਦਾਤਾਵਾਂ ਨੂੰ ਸਵੀਕਾਰ ਕਰਦੇ ਹਾਂ। ਹੋਰ ਜਾਣਕਾਰੀ ਲਈ ਕਿਰਪਾ ਕਰਕੇ ਸਾਡੇ ਬਿਲਿੰਗ ਵਿਭਾਗ ਨਾਲ ਸੰਪਰਕ ਕਰੋ।",
    }
};

let currentPage = 'home-page';

function updateContent(lang) {
    const strings = content[lang];
    document.getElementById('hospital-name').textContent = strings.hospitalName;
    document.getElementById('nav-home').textContent = strings.navHome;
    document.getElementById('nav-3d').textContent = strings.nav3D;
    document.getElementById('nav-chatbot').textContent = strings.navChatbot;
    document.getElementById('nav-contact').textContent = strings.navContact;
    
    // New Hero Section Content
    document.getElementById('hero-title').textContent = strings.heroTitle;
    document.getElementById('hero-subtitle').textContent = strings.heroSubtitle;
    document.getElementById('hero-cta').textContent = strings.heroCta;

    document.getElementById('about-title').textContent = strings.aboutTitle;
    document.getElementById('about-text').textContent = strings.aboutText;
    document.getElementById('services-title').textContent = strings.servicesTitle;
    document.getElementById('service-cardio-title').textContent = strings.serviceCardioTitle;
    document.getElementById('service-cardio-text').textContent = strings.serviceCardioText;
    document.getElementById('service-ortho-title').textContent = strings.serviceOrthoTitle;
    document.getElementById('service-ortho-text').textContent = strings.serviceOrthoText;
    document.getElementById('service-obgyn-title').textContent = strings.serviceObgynTitle;
    document.getElementById('service-obgyn-text').textContent = strings.serviceObgynText;
    document.getElementById('service-dental-title').textContent = strings.serviceDentalTitle;
    document.getElementById('service-dental-text').textContent = strings.serviceDentalText;
    document.getElementById('service-surgery-title').textContent = strings.serviceSurgeryTitle;
    document.getElementById('service-surgery-text').textContent = strings.serviceSurgeryText;
    document.getElementById('service-neuro-title').textContent = strings.serviceNeuroTitle;
    document.getElementById('service-neuro-text').textContent = strings.serviceNeuroText;
    document.getElementById('location-title').textContent = strings.locationTitle;
    document.getElementById('location-card-title').textContent = strings.locationCardTitle;
    document.getElementById('location-text-1').textContent = strings.locationText1;
    document.getElementById('location-address').innerHTML = `<strong class="font-semibold text-gray-800">Address:</strong> ${strings.locationAddress.split(": ")[1]}`;
    document.getElementById('location-phone').innerHTML = `<strong class="font-semibold text-gray-800">Phone:</strong> ${strings.locationPhone.split(": ")[1]}`;

    document.getElementById('3d-title').textContent = strings.threeDTitle;
    document.getElementById('3d-note').textContent = strings.threeDNote;
    
    document.getElementById('chatbot-title').textContent = strings.chatbotTitle;
    document.getElementById('chatbot-intro-message').textContent = strings.chatbotIntroMessage;
    document.getElementById('chat-input').placeholder = strings.chatInputPlaceholder;
    document.getElementById('chat-send-btn').textContent = strings.chatSendBtn;

    document.getElementById('contact-title').textContent = strings.contactTitle;
    document.getElementById('contact-card-title').textContent = strings.contactCardTitle;
    document.getElementById('contact-text-1').textContent = strings.contactText1;
    document.getElementById('contact-phone').textContent = strings.contactPhone;
    document.getElementById('contact-email').innerHTML = `<a href="mailto:info@vardhmanhealthcare.com" class="hover:underline">${strings.contactEmail.split(": ")[1]}</a>`;
    
    document.getElementById('footer-text').innerHTML = strings.footerText;
}

function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');
    currentPage = pageId;
    window.scrollTo(0, 0); // Scroll to top on page change
}

// Initialize language switcher
document.getElementById('language-switcher').addEventListener('change', (event) => {
    updateContent(event.target.value);
});

// Initialize navigation
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (event) => {
        event.preventDefault();
        const page = event.target.getAttribute('data-page');
        if (page) {
            showPage(`${page}-page`);
        }
    });
});

// Chatbot functionality
document.getElementById('chat-send-btn').addEventListener('click', () => {
    handleChatbotMessage();
});
document.getElementById('chat-input').addEventListener('keypress', (event) => {
    if (event.key === 'Enter') {
        handleChatbotMessage();
    }
});

function handleChatbotMessage() {
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    if (message === '') return;

    // Add user message to chat box
    addMessageToChat('user', message);
    input.value = '';

    // Get bot response
    const botResponse = getBotResponse(message);
    
    setTimeout(() => {
        addMessageToChat('bot', botResponse);
    }, 500);
}

function addMessageToChat(sender, message) {
    const chatBox = document.getElementById('chat-box');
    const messageEl = document.createElement('div');
    messageEl.classList.add('flex', 'mb-4');

    if (sender === 'user') {
        messageEl.classList.add('justify-end');
        messageEl.innerHTML = `
            <div class="p-3 bg-blue-600 text-white rounded-xl max-w-[80%]">${message}</div>
        `;
    } else {
        messageEl.classList.add('items-start');
        messageEl.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">Bot</div>
            <div class="ml-3 p-3 bg-blue-100 rounded-xl max-w-[80%]">
                <p class="text-sm">${message}</p>
            </div>
        `;
    }
    chatBox.appendChild(messageEl);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function getBotResponse(message) {
    const lowerCaseMessage = message.toLowerCase();
    const currentLang = document.getElementById('language-switcher').value;
    const strings = content[currentLang];

    // Define a simple knowledge base based on keywords
    const knowledgeBase = {
        greetings: [
            'hi', 'hello', 'hey', 'namaste', 'namaskar', 'sat sri akal', 'bonjour'
        ],
        services: [
            'service', 'services', 'departments', 'specialties', 'services offered'
        ],
        location: [
            'location', 'address', 'find us', 'where are you', 'directions'
        ],
        timings: [
            'timing', 'timings', 'hours', 'when are you open'
        ],
        contact: [
            'phone', 'contact', 'number', 'appointment', 'email'
        ],
        insurance: [
            'insurance', 'insurances', 'accept insurance', 'billing', 'coverage'
        ]
    };

    // Check for a greeting first
    for (const keyword of knowledgeBase.greetings) {
        if (lowerCaseMessage.includes(keyword)) {
            return strings.greetings;
        }
    }

    // Check for 'services' intent
    for (const keyword of knowledgeBase.services) {
        if (lowerCaseMessage.includes(keyword) || (currentLang === 'hi' && lowerCaseMessage.includes('सेवा')) || (currentLang === 'pa' && lowerCaseMessage.includes('ਸੇਵਾ'))) {
            return strings.servicesTitle + ": " + strings.serviceCardioTitle + ", " + strings.serviceOrthoTitle + ", " + strings.serviceObgynTitle + ", etc.";
        }
    }

    // Check for 'location' intent
    for (const keyword of knowledgeBase.location) {
        if (lowerCaseMessage.includes(keyword) || (currentLang === 'hi' && lowerCaseMessage.includes('स्थान')) || (currentLang === 'pa' && lowerCaseMessage.includes('ਟਿਕਾਣਾ'))) {
            return strings.locationCardTitle + ": " + strings.locationAddress.split(": ")[1];
        }
    }

    // Check for 'timings' intent
    for (const keyword of knowledgeBase.timings) {
        if (lowerCaseMessage.includes(keyword) || (currentLang === 'hi' && lowerCaseMessage.includes('समय')) || (currentLang === 'pa' && lowerCaseMessage.includes('ਸਮਾਂ'))) {
            return "Our OPD timings are 10:30 AM to 3:00 PM, Monday to Saturday.";
        }
    }

    // Check for 'contact' intent
    for (const keyword of knowledgeBase.contact) {
        if (lowerCaseMessage.includes(keyword) || (currentLang === 'hi' && lowerCaseMessage.includes('संपर्क')) || (currentLang === 'pa' && lowerCaseMessage.includes('ਫ਼ੋਨ'))) {
            return strings.contactPhone.split(": ")[1];
        }
    }

    // Check for 'insurance' intent
    for (const keyword of knowledgeBase.insurance) {
        if (lowerCaseMessage.includes(keyword)) {
            return strings.insurance;
        }
    }

    // Fallback response if no keywords are matched
    return "I'm sorry, I couldn't understand that. You can ask me about our services, timings, or location.";
}


// Intersection Observer for fade-in animation
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
        }
    });
}, {
    threshold: 0.1
});

document.querySelectorAll('.fade-in').forEach(element => {
    observer.observe(element);
});

// Leaflet Map Initialization
function initializeMap() {
    // Check if map is already initialized to prevent errors
    if (document.getElementById('map')._leaflet_id) {
        document.getElementById('map')._leaflet_id = undefined;
    }
    const lat = 30.3421;
    const lng = 76.3861;
    const zoom = 15;

    const map = L.map('map').setView([lat, lng], zoom);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    L.marker([lat, lng]).addTo(map)
        .bindPopup('Vardhman Mahaveer Health Care, Patiala')
        .openPopup();
}

// Three.js 3D Model Initialization
function initialize3DModel() {
    const container = document.getElementById('three-container');
    const width = container.clientWidth;
    const height = container.clientHeight;

    // Scene, Camera, Renderer
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xcce0ff); // Light blue sky
    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(width, height);
    container.appendChild(renderer.domElement);

    // Responsive design for 3D model
    const resizeObserver = new ResizeObserver(entries => {
        for (let entry of entries) {
            const newWidth = entry.contentRect.width;
            const newHeight = entry.contentRect.height;
            renderer.setSize(newWidth, newHeight);
            camera.aspect = newWidth / newHeight;
            camera.updateProjectionMatrix();
        }
    });
    resizeObserver.observe(container);

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(50, 100, 75);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    // Ground Plane
    const groundGeometry = new THREE.PlaneGeometry(200, 200);
    const groundMaterial = new THREE.MeshStandardMaterial({ color: 0x90ee90 }); // Light green for grass
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Create a symbolic hospital building based on the provided image
    const group = new THREE.Group();

    // Main central block (White/Light Grey)
    const mainBlock = new THREE.Mesh(new THREE.BoxGeometry(10, 8, 4), new THREE.MeshStandardMaterial({ color: 0xe0e0e0 }));
    mainBlock.position.y = 4;
    mainBlock.castShadow = true;
    mainBlock.receiveShadow = true;
    group.add(mainBlock);

    // Left side block (Dark Grey)
    const leftBlock = new THREE.Mesh(new THREE.BoxGeometry(2.5, 9, 4), new THREE.MeshStandardMaterial({ color: 0x4a4a4a }));
    leftBlock.position.set(-6.25, 4.5, 0);
    leftBlock.castShadow = true;
    leftBlock.receiveShadow = true;
    group.add(leftBlock);

    // Right side panels (alternating light/dark)
    const rightPanel1 = new THREE.Mesh(new THREE.BoxGeometry(2, 4.5, 4), new THREE.MeshStandardMaterial({ color: 0x4a4a4a }));
    rightPanel1.position.set(6, 6.75, 0);
    rightPanel1.castShadow = true;
    rightPanel1.receiveShadow = true;
    group.add(rightPanel1);

    const rightPanel2 = new THREE.Mesh(new THREE.BoxGeometry(2, 4.5, 4), new THREE.MeshStandardMaterial({ color: 0xc4c4c4 }));
    rightPanel2.position.set(6, 2.25, 0);
    rightPanel2.castShadow = true;
    rightPanel2.receiveShadow = true;
    group.add(rightPanel2);
    

    // Recessed part in the middle to match the image
    const recessedGeometry = new THREE.BoxGeometry(6, 8, 0.2);
    const recessedMaterial = new THREE.MeshStandardMaterial({ color: 0x2c2c2c });
    const recessedSection = new THREE.Mesh(recessedGeometry, recessedMaterial);
    recessedSection.position.set(0.75, 4, 1.9);
    group.add(recessedSection);

    // Glass window section
    const windowGeometry = new THREE.BoxGeometry(5.5, 6, 0.1);
    const windowMaterial = new THREE.MeshStandardMaterial({ color: 0x6699ff, transparent: true, opacity: 0.8 });
    const windowSection = new THREE.Mesh(windowGeometry, windowMaterial);
    windowSection.position.set(0.75, 4.5, 1.95);
    group.add(windowSection);

    // "EMERGENCY" sign
    const emergencySignTexture = new THREE.TextureLoader().load("https://placehold.co/100x400/ff0000/ffffff?text=E%0AM%0AE%0AR%0AG%0AE%0AN%0AC%0AY");
    const emergencySign = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 8), new THREE.MeshStandardMaterial({ map: emergencySignTexture }));
    emergencySign.position.set(-5.5, 4, 2.02);
    group.add(emergencySign);
    
    const modernSignTexture = new THREE.TextureLoader().load("https://placehold.co/400x100/ffffff/000000?text=MODERN+LABORATORY+AND+IMAGING+CENTRE");
    const modernSign = new THREE.Mesh(new THREE.PlaneGeometry(5, 1), new THREE.MeshStandardMaterial({ map: modernSignTexture }));
    modernSign.position.set(-0.25, 2.5, 2.02);
    group.add(modernSign);

    const hospitalSignTexture = new THREE.TextureLoader().load("https://placehold.co/600x100/ffffff/000000?text=VARDHMAN+MAHAVEER+HEALTH+CARE");
    const hospitalSignTop = new THREE.Mesh(new THREE.PlaneGeometry(8, 1), new THREE.MeshStandardMaterial({ map: hospitalSignTexture }));
    hospitalSignTop.position.set(0.75, 8.5, 2.02);
    group.add(hospitalSignTop);

    const hospitalSignBottom = new THREE.Mesh(new THREE.BoxGeometry(8, 1), new THREE.MeshStandardMaterial({ map: hospitalSignTexture }));
    hospitalSignBottom.position.set(0.75, 0.5, 2.02);
    group.add(hospitalSignBottom);
    
    scene.add(group);
    camera.position.set(15, 10, 15);
    camera.lookAt(new THREE.Vector3(0, 4, 0));

    // Mouse controls for rotation and panning
    let isDragging = false;
    let isPanning = false;
    let previousMousePosition = { x: 0, y: 0 };

    const onMouseDown = (event) => {
        if (event.button === 0) { // Left mouse button
            isDragging = true;
            container.style.cursor = 'grabbing';
        } else if (event.button === 2) { // Right mouse button
            isPanning = true;
            container.style.cursor = 'move';
        }
        previousMousePosition.x = event.clientX;
        previousMousePosition.y = event.clientY;
    };

    const onMouseMove = (event) => {
        if (isDragging) {
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;
            group.rotation.y += deltaX * 0.01;
            group.rotation.x += deltaY * 0.01;
            if (group.rotation.x > Math.PI / 2) group.rotation.x = Math.PI / 2;
            if (group.rotation.x < -Math.PI / 2) group.rotation.x = -Math.PI / 2;
        }
        if (isPanning) {
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;
            camera.position.x -= deltaX * 0.01;
            camera.position.y += deltaY * 0.01;
        }
        previousMousePosition.x = event.clientX;
        previousMousePosition.y = event.clientY;
    };

    const onMouseUp = (event) => {
        isDragging = false;
        isPanning = false;
        container.style.cursor = 'grab';
    };

    // Touch events for mobile
    let touchStart = null;
    let touchPanStart = null;

    const onTouchStart = (event) => {
        if (event.touches.length === 1) {
            isDragging = true;
            touchStart = { x: event.touches[0].clientX, y: event.touches[0].clientY };
        } else if (event.touches.length === 2) {
            isPanning = true;
            touchPanStart = { x: event.touches[0].clientX, y: event.touches[0].clientY };
        }
    };

    const onTouchMove = (event) => {
        if (isDragging && event.touches.length === 1) {
            const deltaX = event.touches[0].clientX - touchStart.x;
            const deltaY = event.touches[0].clientY - touchStart.y;
            group.rotation.y += deltaX * 0.01;
            group.rotation.x += deltaY * 0.01;
            if (group.rotation.x > Math.PI / 2) group.rotation.x = Math.PI / 2;
            if (group.rotation.x < -Math.PI / 2) group.rotation.x = -Math.PI / 2;
            touchStart = { x: event.touches[0].clientX, y: event.touches[0].clientY };
        } else if (isPanning && event.touches.length === 2) {
            const deltaX = event.touches[0].clientX - touchPanStart.x;
            const deltaY = event.touches[0].clientY - touchPanStart.y;
            camera.position.x -= deltaX * 0.01;
            camera.position.y += deltaY * 0.01;
            touchPanStart = { x: event.touches[0].clientX, y: event.touches[0].clientY };
        }
        event.preventDefault();
    };

    const onTouchEnd = () => {
        isDragging = false;
        isPanning = false;
    };

    container.addEventListener('contextmenu', (e) => e.preventDefault());
    container.addEventListener('mousedown', onMouseDown);
    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('mouseup', onMouseUp);
    container.addEventListener('touchstart', onTouchStart, { passive: false });
    container.addEventListener('touchmove', onTouchMove, { passive: false });
    container.addEventListener('touchend', onTouchEnd);

    // Animation loop
    const animate = () => {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    };
    animate();
}

// Initialize elements on load
window.onload = function() {
    // Initialize the map on page load
    initializeMap();
    // Initialize 3D model when the page for it is displayed
    let threeDInitialized = false;
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (event) => {
            const page = event.target.getAttribute('data-page');
            showPage(`${page}-page`);
            if (page === '3d-view' && !threeDInitialized) {
                initialize3DModel();
                threeDInitialized = true;
            } else if (page === 'home') {
                initializeMap();
            }
        });
    });

    // Initial content update
    updateContent('en');
};
